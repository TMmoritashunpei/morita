ステージング
ec2でmvサーバーを作る
ムーバブルタイプでhtmlｃｓｓ作り
s3で公開する

Mtユーザー
morita
パスワード　68916891


http://mt.shumpeimorita.work/

/data/file/static

AWSCLI

コマンドラインインターフェイス

phpmyadmin

ssh ec2-user
秘密鍵

パスワード変更
sudo passwd

68916891

タイムゾーン確認
date

UTCを変える
タイムゾーン変更
sudo cp /usr/share/zoneinfo/Japan /etc/localtime

movale type の言語変更
DefaultLanguage ja
DefaultTimezone 9



awscli　セットアップ
aws configure
IAM　S3にフルアクセスできる
アクセスキー
シークレットキー入れる

https://docs.aws.amazon.com/ja_jp/general/latest/gr/rande.html
リージョン ap-south-1
出力ファイル json

転送元ファイルを確認する
cd /data/file/static
ls -l

index.hrmlもできている

e2cからs3にファイル転送
aws s3 sync /data/file/static s3://www.shumpeimorita.work/
※www～はバゲットの名前入れる
mt-ataticの内容をwebサーバーにコピーする
初回のみ
aws s3 sync /app/movabletype/mt-static s3://www.shumpeimorita.work/mt-static

転送元ファイル確認

cd /data/file/static

反映するまで
時間差がある




マルチAZ
AZはアベラビリティゾーン


複数のAZに同じものを置いてやることで
一つダメでも生き残る

冗長化

ロードバランサ―が振り分けをする
自分の領域に入ってきた
PVCに入ってきた場合

AWSのロードバランサ―はAWS側がメンテナンスしてくれる。

マルチAZ
のRDS
大きいシステムの場合必ずなっている
DBもロードバランサ―を使う
マルチAZ設定

rote53
も同じようにできる

sqsキューを振り分ける

対障害性
ハングル　固まる


マルチAZの強み

フェールオーバー
二大構成　
マスターと　スレーブ
マスターが落ちたら　スレーブが昇格して
マスターを再起動してスレーブする


RDS用二つサブネット作る
別々のAZ

DBサブネットグループ作成
スナップショット　バックアップ

スロークエリ
戻りが遅いsql


DBインスタンス作成


root
6896891


踏み台サーバーを設定する
ec2のワードプレスのセキュリティグループを選択することによりサーバーを経由することができる



ec2インスタンス
パスワード


[   19.400181] bitnami[1165]: #########################################################################
[   19.409116] bitnami[1165]: #                                                                       #
[   19.420273] bitnami[1165]: #        Setting Bitnami application password to 'B0HQksEcuf60'         #
[   19.431701] bitnami[1165]: #        (the default application username is 'user')                   #
[   19.441107] bitnami[1165]: #                                                                       #
[   19.449565] bitnami[1165]: ########################################################################

ttl
bitnami

B0HQksEcuf60
秘密鍵

mysql接続

mysql -h morita-db1.cilqblfr3jph.ap-south-1.rds.amazonaws.com -u root -p
68916891
rdsのエンドポイントを指定する




// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define('DB_NAME', 'bitnami_wordpress');

/** MySQL database username */
define('DB_USER', 'bn_wordpress');

/** MySQL database password */
define('DB_PASSWORD', '12885fb618');

/** MySQL hostname */
define('DB_HOST', 'localhost:3306');

/** Database Charset to use in creating database tables. */
define('DB_CHARSET', 'utf8');

/** The Database Collate type. Don't change this if in doubt. */
define('DB_COLLATE', '');

ファイルダンプ

mysqldump -u bn_wordpress -p bitnami_wordpress > wpdb.sql

ファイル読み込み

mysql -h morita-db1.cilqblfr3jph.ap-south-1.rds.amazonaws.com -u root -p moritadb < wpdb.sql
